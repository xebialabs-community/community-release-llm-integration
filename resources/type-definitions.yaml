# JSON Schema: https://raw.githubusercontent.com/digital-ai/release-api/main/synthetic-type-definitions/type-definition-schema.json
#
# Yaml-based format to define types in Release, as an alternative to synthetic.xml or type-definitions.xml
# This format is in Tech Preview in Release 23.3 and may change in future versions.
#
# You can also use synthetic.xml or type-definitions.xml to define types. Note that contents of the two files
# are merged. This means that you can't have the same type definition in both
# type-definitions.yaml and synthetic.xml or type-definitions.xml at the same time.

types:

  #
  # MCP
  #

  # MCP Server

  community-llm.McpServer:
    extends: configuration.ContainerHttpConnection
    label: "MCP: Server"
    description: MCP Server configuration
    
    properties:
      url:
        description: The target MCP Server URL
        required: true
      transport:
        label: Transport Protocol
        description: The transport protocol to use
        kind: enum
        default: http
        enum-values:
          - http
          - sse
      headers:
        description: Additional HTTP headers to include in requests
        kind: map_string_string
        required: false

    hidden-properties:
      testConnectionScript: community-llm.McpTestConnection

  # MCP tasks

  community-llm.McpBaseTask:
    extends: xlrelease.ContainerTask
    virtual: true

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: mcp.png
      taskColor: "#5F5FFF"

    input-properties:
      server:
        description: The MCP server
        kind: ci
        referenced-type: community-llm.McpServer

  community-llm.McpCallTool:
    extends: community-llm.McpBaseTask
    label: "MCP: Call Tool"
    description: Calls an MCP tool

    input-properties:
      tool:
        description: The name of the tool to call
        kind: string
        input-hint:
          method-ref: tool-lookup

      input:
        description: The input as a JSON string.
        kind: string
        size: large
        required: false

    output-properties:
      result:
        kind: string

    methods:
      tool-lookup:
        delegate: remoteScriptLookup
        script: community-llm.McpToolLookupScript
        containerConnection: server

  community-llm.McpListToolsTask: # suffixed with "Task" to avoid name clash with OpenAI type
    extends: community-llm.McpBaseTask
    label: "MCP: List Tools"
    description: Lists available tools on the MCP server

    output-properties:
      tools:
        label: Tool definitions
        description: The available tools on the MCP server and their descriptions
        kind: map_string_string

      inputSchema:
        label: Input schema
        description: The input schema for each tool
        kind: map_string_string

  # MCP Scripts

  community-llm.McpBaseScript:
    extends: xlrelease.RemoteScriptExecution
    virtual: true

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true

    output-properties:
      commandResponse:
        kind: map_string_string

  community-llm.McpTestConnection:
    extends: community-llm.McpBaseScript

    input-properties:
      server:
        kind: ci
        referenced-type: community-llm.McpServer

  community-llm.McpToolLookupScript:
    extends: community-llm.McpBaseScript

    input-properties:
      _ci:
        kind: ci
        referenced-type: community-llm.McpBaseTask
      _attributes:
        kind: map_string_string
      _parameters:
        kind: ci
        referenced-type: udm.Parameters

  #
  # AI Models
  #

  community-llm.BaseModel:
    extends: xlrelease.Configuration
    virtual: true

    properties:
      apiKey:
        label: API Key
        description: API Key for the LLM provider
        required: true
        password: true
      model_id:
        label: AI Model
        description: The model to use
        kind: string

  community-llm.GeminiModel:
    extends: community-llm.BaseModel
    label: "AI Model: Gemini"

    hidden-properties:
      provider:
        default: gemini

    properties:
      apiKey:
        label: Gemini API Key
        description: API Key for Google Gemini
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string
        default: gemini-2.5-flash

  community-llm.OpenAiModel:
    extends: community-llm.BaseModel
    label: "AI Model: OpenAI"

    hidden-properties:
      provider:
        default: openai

    properties:
      url:
        label: API URL
        description: The URL to each the OpenAI API
        kind: string
        default: https://api.openai.com/v1
      apiKey:
        label: API Key
        description: API Key for the LLM provider
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string

  community-llm.DaiLlmModel:
    extends: community-llm.BaseModel
    label: "AI Model: Digital.ai LLM"

    hidden-properties:
      provider:
        default: dai-llm

    properties:
      url:
        label: API URL
        description: The URL to each the Digital.ai LLM Service
        kind: string
        default: https://api.staging.digital.ai/llm
      apiKey:
        label: API Key
        description: API Key for the LLM provider
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string

  #
  # LLM tasks
  #

  community-llm.BasePrompt:
    extends: xlrelease.ContainerTask
    virtual: true

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: prompt.png
      taskColor: "#C88BFF"

  community-llm.LlmPrompt:
    extends: community-llm.BasePrompt
    label: "AI: Prompt"
    description: Sends a single prompt to an LLM service

    input-properties:
      prompt:
        description: The prompt to be answered by the AI model
        kind: string
        size: large
      model:
        description: The reasoning model to use
        kind: ci
        referenced-type: community-llm.BaseModel

    output-properties:
      response:
        description: The AI response
        kind: string

  community-llm.LlmChat:
    extends: community-llm.BasePrompt
    label: "AI: Chat"
    description: Chats with the LLM. Send 'Stop chat' to end the chat.

    input-properties:
      model:
        description: The LLM model to use
        kind: ci
        referenced-type: community-llm.BaseModel

    output-properties:
      response:
        description: The AI response
        kind: string


  community-llm.LlmAgent:
    extends: xlrelease.ContainerTask
    label: "AI: Agent"
    description: Asks AI agent to do something with multiple MCP server support.

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: agent.png
      taskColor: "#EE9037"

    input-properties:
      prompt:
        description: The prompt to send to the agent
        kind: string
        size: large
      model:
        description: The reasoning model to use
        kind: ci
        referenced-type: community-llm.BaseModel
      mcpServer1:
        label: MCP Server 1
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: community-llm.McpServer
      mcpServer2:
        label: MCP Server 2
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: community-llm.McpServer
      mcpServer3:
        label: MCP Server 3
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: community-llm.McpServer

    output-properties:
      result:
        description: The result returned by the agent
        kind: string
